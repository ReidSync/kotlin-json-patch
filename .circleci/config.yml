# Use the latest 2.1 version of CircleCI pipeline process engine.
# See: https://circleci.com/docs/configuration-reference
version: 2.1

orbs:
  android: circleci/android@1.0.3

# Define a job to be invoked later in a workflow.
# See: https://circleci.com/docs/configuration-reference/#jobs
jobs:
  build-android:
    executor: android/android

    steps:
      - checkout
      - android/restore-build-cache
      - android/restore-gradle-cache
      - run:
          name: Run Android tests
          command: ./gradlew :sharedKotlinJsonPatch:cleanTestDebugUnitTest :sharedKotlinJsonPatch:testDebugUnitTest --tests "com.reidsync.kxjsonpatch.*"
      - android/save-gradle-cache
      - android/save-build-cache

  build-ios:
    macos:
      xcode: 15.4.0
    steps:
      - checkout
      - run:
          name: Run iOS tests
          command: ./gradlew :sharedKotlinJsonPatch:cleanIosSimulatorArm64Test :sharedKotlinJsonPatch:iosSimulatorArm64Test --tests "com.reidsync.kxjsonpatch.*"
          
# Orchestrate jobs using workflows
# See: https://circleci.com/docs/configuration-reference/#workflows
workflows:
  build-all:
    jobs:
      - build-android
      - build-ios
